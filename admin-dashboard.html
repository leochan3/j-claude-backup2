<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobSpy Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .environment-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .env-local {
            background: #10b981;
            color: white;
        }

        .env-production {
            background: #f59e0b;
            color: white;
        }

        .tab-container {
            background: white;
            margin: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tab-navigation {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            overflow-x: auto;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 16px 24px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #64748b;
            white-space: nowrap;
            transition: all 0.2s ease;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-button:hover {
            background: #e2e8f0;
            color: #475569;
        }

        .tab-button.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: white;
        }

        .tab-icon {
            font-size: 1.2rem;
        }

        .tab-content {
            height: calc(100vh - 200px);
            overflow: auto;
        }

        .tab-panel {
            display: none;
            height: 100%;
        }

        .tab-panel.active {
            display: block;
        }

        .iframe-container {
            width: 100%;
            height: 100%;
            min-height: 800px;
            border: none;
            background: white;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #64748b;
            font-size: 1.1rem;
        }

        .loading::before {
            content: "‚è≥";
            margin-right: 8px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .tab-container {
                margin: 10px;
            }
            
            .tab-button {
                padding: 12px 16px;
                font-size: 0.9rem;
            }
            
            .environment-indicator {
                position: static;
                margin-top: 10px;
                display: inline-block;
            }
        }

        .error-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #ef4444;
            text-align: center;
            padding: 40px;
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .retry-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 1rem;
        }

        .retry-button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="header">
        <div id="environment-indicator" class="environment-indicator">
            <span id="env-text">üîÑ Detecting...</span>
        </div>
        <h1>üõ†Ô∏è JobSpy Admin Dashboard</h1>
        <p>Unified management interface for all admin functions</p>
    </div>

    <div class="tab-container">
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="database">
                <span class="tab-icon">üóÑÔ∏è</span>
                Database
            </button>
            <button class="tab-button" data-tab="scraping">
                <span class="tab-icon">üîç</span>
                Scraping
            </button>
            <button class="tab-button" data-tab="users">
                <span class="tab-icon">üë•</span>
                Users
            </button>
            <button class="tab-button" data-tab="testing">
                <span class="tab-icon">üß™</span>
                Testing
            </button>
            <button class="tab-button" data-tab="api">
                <span class="tab-icon">üìö</span>
                API Docs
            </button>
        </div>

        <div class="tab-content">
            <div id="database-tab" class="tab-panel active">
                <div class="loading">Loading Database Viewer...</div>
            </div>
            <div id="scraping-tab" class="tab-panel">
                <div class="loading">Loading Scraping Interface...</div>
            </div>
            <div id="users-tab" class="tab-panel">
                <div class="loading">Loading User Management...</div>
            </div>
            <div id="testing-tab" class="tab-panel">
                <div class="loading">Loading Test Dashboard...</div>
            </div>
            <div id="api-tab" class="tab-panel">
                <div class="loading">Loading API Documentation...</div>
            </div>
        </div>
    </div>

    <script>
        // Detect environment and set base URL
        const isProduction = window.location.hostname.includes('render.com') || 
                            window.location.hostname.includes('onrender.com');
        
        const BASE_URL = isProduction 
            ? 'https://j-claude-backup2-1.onrender.com'
            : 'http://localhost:8000';

        // Update environment indicator
        const envIndicator = document.getElementById('environment-indicator');
        const envText = document.getElementById('env-text');
        
        if (isProduction) {
            envIndicator.className = 'environment-indicator env-production';
            envText.textContent = 'üåê PRODUCTION';
        } else {
            envIndicator.className = 'environment-indicator env-local';
            envText.textContent = 'üíª LOCAL';
        }

        // Tab configuration
        const tabs = {
            database: {
                url: `${BASE_URL}/database-viewer`,
                title: 'Database Viewer'
            },
            scraping: {
                url: `${BASE_URL}/scraping-interface`,
                title: 'Scraping Interface (shows live progress)'
            },
            users: {
                url: `${BASE_URL}/user-management`,
                title: 'User Management'
            },
            testing: {
                url: `${BASE_URL}/test-dashboard`,
                title: 'Test Dashboard'
            },
            api: {
                url: `${BASE_URL}/docs`,
                title: 'API Documentation'
            }
        };

        // Track loaded iframes to avoid reloading
        const loadedTabs = new Set();

        // Tab switching functionality
        function switchTab(tabName) {
            // Update active tab button
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update active tab panel
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // Load iframe if not already loaded
            if (!loadedTabs.has(tabName)) {
                loadTab(tabName);
                loadedTabs.add(tabName);
            }
        }

        function loadTab(tabName) {
            const tabPanel = document.getElementById(`${tabName}-tab`);
            const config = tabs[tabName];
            
            // Create iframe
            const iframe = document.createElement('iframe');
            iframe.src = config.url;
            iframe.className = 'iframe-container';
            iframe.title = config.title;
            
            // Handle load events
            iframe.onload = function() {
                // Remove loading indicator
                const loading = tabPanel.querySelector('.loading');
                if (loading) {
                    loading.remove();
                }
            };
            
            iframe.onerror = function() {
                // Show error message
                tabPanel.innerHTML = `
                    <div class="error-panel">
                        <div class="error-icon">‚ùå</div>
                        <h2>Failed to load ${config.title}</h2>
                        <p>Could not connect to ${config.url}</p>
                        <button class="retry-button" onclick="retryLoad('${tabName}')">
                            üîÑ Retry
                        </button>
                    </div>
                `;
            };
            
            // Replace loading with iframe
            setTimeout(() => {
                tabPanel.appendChild(iframe);
            }, 500); // Small delay to show loading state
        }

        function retryLoad(tabName) {
            const tabPanel = document.getElementById(`${tabName}-tab`);
            tabPanel.innerHTML = '<div class="loading">Retrying...</div>';
            loadedTabs.delete(tabName);
            loadTab(tabName);
        }

        // Event listeners for tab buttons
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        // Load initial tab
        document.addEventListener('DOMContentLoaded', () => {
            // Check if there's a hash in URL to determine initial tab
            const hash = window.location.hash.substring(1);
            const initialTab = tabs[hash] ? hash : 'database';
            
            switchTab(initialTab);
        });

        // Update URL hash when switching tabs
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                window.location.hash = tabName;
            });
        });

        // Handle browser back/forward
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.substring(1);
            const tabName = tabs[hash] ? hash : 'database';
            switchTab(tabName);
        });

        console.log('üõ†Ô∏è JobSpy Admin Dashboard loaded');
        console.log(`üìç Environment: ${isProduction ? 'Production' : 'Local'}`);
        console.log(`üîó Base URL: ${BASE_URL}`);
    </script>
</body>
</html>